<template>
    <nav class="flex jc-c ai-c sticky top-0"> <!-- bg-surface-1 -->
        <div class="top-bar-wrapper flex flex-1 ai-c jc-sb">
            <router-link id="logo" :to="{ name: 'Home' }">
                <svg xmlns="http://www.w3.org/2000/svg"  height="16" viewBox="0 0 81.847 14.267">
                    <path d="M4156.063-14213.8a5.022,5.022,0,0,1-1.6-1.085,5.03,5.03,0,0,1-1.075-1.6,4.892,4.892,0,0,1-.389-1.953,4.81,4.81,0,0,1,.371-1.882,4.846,4.846,0,0,1,1.032-1.543,4.946,4.946,0,0,1,1.539-1.042,4.681,4.681,0,0,1,1.871-.375,3.352,3.352,0,0,1,1.667.41,4.3,4.3,0,0,1,1.25,1.05l-.1-1.2h2.285v9.365h-2.289l-.1-1.157a3.015,3.015,0,0,1-1.018,1.015,2.772,2.772,0,0,1-1.489.389A4.861,4.861,0,0,1,4156.063-14213.8Zm.571-6.9a2.724,2.724,0,0,0-.943.985,2.775,2.775,0,0,0-.346,1.379,2.729,2.729,0,0,0,.354,1.378,2.762,2.762,0,0,0,.953.981,2.409,2.409,0,0,0,1.3.368,2.285,2.285,0,0,0,1.289-.368,2.509,2.509,0,0,0,.882-.988,2.929,2.929,0,0,0,.318-1.371,3,3,0,0,0-.318-1.382,2.588,2.588,0,0,0-.885-.985,2.311,2.311,0,0,0-1.286-.364A2.483,2.483,0,0,0,4156.634-14220.7Zm-46.345,5.956a4.811,4.811,0,0,1-1.3-3.5v-.282a4.768,4.768,0,0,1,1.311-3.5,4.519,4.519,0,0,1,3.374-1.335,4.255,4.255,0,0,1,3.26,1.25,4.822,4.822,0,0,1,1.171,3.424v.921h-6.576a3.2,3.2,0,0,0,.578,1.7,2.051,2.051,0,0,0,1.767.8,2.454,2.454,0,0,0,1.368-.375,3.456,3.456,0,0,0,.936-.875l1.742,1.2a3.524,3.524,0,0,1-1.5,1.346,5.374,5.374,0,0,1-2.51.554A4.823,4.823,0,0,1,4110.289-14214.74Zm5.3-4.642v-.164a2.174,2.174,0,0,0-.479-1.39,1.734,1.734,0,0,0-1.446-.6,1.809,1.809,0,0,0-1.589.8,3.14,3.14,0,0,0-.5,1.347Zm-27.522,5.584a5.024,5.024,0,0,1-1.6-1.085,5.043,5.043,0,0,1-1.075-1.6,4.9,4.9,0,0,1-.389-1.953,4.806,4.806,0,0,1,.371-1.882,4.839,4.839,0,0,1,1.032-1.543,4.942,4.942,0,0,1,1.539-1.042,4.694,4.694,0,0,1,1.871-.375,3.351,3.351,0,0,1,1.667.41,4.3,4.3,0,0,1,1.25,1.05l-.1-1.2h2.285v9.365h-2.289l-.1-1.157a3.008,3.008,0,0,1-1.018,1.015,2.771,2.771,0,0,1-1.489.389A4.875,4.875,0,0,1,4088.062-14213.8Zm.571-6.9a2.723,2.723,0,0,0-.943.985,2.775,2.775,0,0,0-.346,1.379,2.7,2.7,0,0,0,.357,1.378,2.72,2.72,0,0,0,.95.981,2.408,2.408,0,0,0,1.3.368,2.285,2.285,0,0,0,1.289-.368,2.511,2.511,0,0,0,.882-.988,2.929,2.929,0,0,0,.318-1.371,3,3,0,0,0-.318-1.382,2.587,2.587,0,0,0-.885-.985,2.309,2.309,0,0,0-1.285-.364A2.484,2.484,0,0,0,4088.634-14220.7Zm52.5,6.467a2.677,2.677,0,0,1-1.118-2.285v-.1l2.506.007v.129a1.126,1.126,0,0,0,.486,1.007,2.282,2.282,0,0,0,1.3.325,2.184,2.184,0,0,0,1.264-.3.96.96,0,0,0,.429-.824.837.837,0,0,0-.415-.768,7.844,7.844,0,0,0-2.035-.568,5.2,5.2,0,0,1-2.478-1.031,2.364,2.364,0,0,1-.789-1.843,2.462,2.462,0,0,1,1.082-2.089,4.863,4.863,0,0,1,2.921-.789,4.836,4.836,0,0,1,2.945.818,2.578,2.578,0,0,1,1.1,2.188v.1h-2.5v-.129a1.14,1.14,0,0,0-.378-.906,1.748,1.748,0,0,0-1.178-.332,1.919,1.919,0,0,0-1.146.268.846.846,0,0,0-.35.7.8.8,0,0,0,.407.7,7.529,7.529,0,0,0,2.082.582,5.212,5.212,0,0,1,2.467,1.018,2.388,2.388,0,0,1,.789,1.9,2.641,2.641,0,0,1-1.068,2.214,5.106,5.106,0,0,1-3.146.821A5.3,5.3,0,0,1,4141.131-14214.229Zm-36.648.1a2.914,2.914,0,0,1-.8-2.26v-4.863h-1.457v-1.828h1.464v-2.07h2.524v2.07h1.807v1.828h-1.807v4.827a1.257,1.257,0,0,0,.236.871.9.9,0,0,0,.682.247,1.95,1.95,0,0,0,.425-.05,3.176,3.176,0,0,0,.414-.133v1.814a2.587,2.587,0,0,1-.579.188,3.772,3.772,0,0,1-.8.079A3.02,3.02,0,0,1,4104.483-14214.134Zm59.442.461v-9.412h2.542v9.412Zm-28.207,0v-9.412h2.542v9.412Zm-4.345,0v-5.859a2.037,2.037,0,0,0-.382-1.367,1.423,1.423,0,0,0-1.114-.433,1.8,1.8,0,0,0-1.121.357,2.516,2.516,0,0,0-.761.972v6.33h-2.539v-5.842a2.08,2.08,0,0,0-.389-1.385,1.436,1.436,0,0,0-1.132-.433,1.794,1.794,0,0,0-1.107.354,2.467,2.467,0,0,0-.753.976v6.33h-2.535v-9.412h2.4l.061,1.1h.05a2.87,2.87,0,0,1,1.157-.95,3.6,3.6,0,0,1,1.536-.332,3.456,3.456,0,0,1,1.731.411,2.435,2.435,0,0,1,1.078,1.21h.036a3.256,3.256,0,0,1,1.335-1.214,3.962,3.962,0,0,1,1.768-.407,3.171,3.171,0,0,1,2.342.886,4.081,4.081,0,0,1,.885,2.956v5.749Zm-34.923,0v-9.412h2.4l.061,1.054h.05a2.956,2.956,0,0,1,.811-.921,1.893,1.893,0,0,1,1.178-.39,1.771,1.771,0,0,1,.378.043,1.425,1.425,0,0,1,.275.082v2.182a2.4,2.4,0,0,0-.343-.061c-.118-.011-.25-.019-.393-.019a1.865,1.865,0,0,0-1.153.372,2.192,2.192,0,0,0-.725.928v6.142Zm39.44-11.012a1.323,1.323,0,0,1-.386-.968,1.312,1.312,0,0,1,.386-.96,1.488,1.488,0,0,1,1.1-.39,1.469,1.469,0,0,1,1.1.394,1.3,1.3,0,0,1,.385.96,1.32,1.32,0,0,1-.385.964,1.481,1.481,0,0,1-1.1.39A1.469,1.469,0,0,1,4135.889-14224.685Z" transform="translate(-4084.999 14227.672)"/>
                    <circle cx="1.5" cy="1.5" r="1.5" transform="translate(78.847)" fill="#0085ff"/>
                </svg>
            </router-link>
            <div v-if="!auth" class="flex gap-8">
                <button @click="signUp" type="submit" class="button-primary default ai-c jc-c fw-600 fs-09">Sign up</button>
                <button @click="signIn" type="submit" class="button-outline default fw-600 ai-c jc-c fs-09">Log in</button>
            </div>
            <div v-else-if="auth && user" class="flex ai-c gap-4">
                <span class="user-name">{{ user.username }}</span>
                <button @click="handleDropdown('user_acc_dropdown')" id="user_acc_dropdown" class="gap-8 bg-transparent pd-0 jc-c ai-c">
                    <profile-avatar
                        :image="user.picture"
                        :width="40"
                        :height="40"
                        :color="user.color"
                        :name="user.username"
                        :fontSize="1"
                        :upload="false"
                    />
                </button>
            </div>
        </div>
    </nav>
    <teleport to="body">
        <backdrop @click="handleDropdown('user_acc_dropdown')" v-if="dropdownToggle" :opacity="0" :zindex="101" />
        <div v-if="dropdownToggle" class="dropdown fixed" :style="{ top: dropdown.top + 54 + 'px', left: dropdown.left - 130 + 'px'}">
            <ul>
                <li @click="handleDropdown('user_acc_dropdown')">
                    <router-link :to="{ name: 'PublicProfile', params: { username: user.username } }" class="flex ai-c gap-10">
                        <svg viewBox="0 0 19.576 20.304">
                            <path d="M-2112.987,138.1v.027a4.8,4.8,0,0,0-.927-2.5,5.342,5.342,0,0,0-2.116-1.662,10.7,10.7,0,0,0-4.425-.809c-2.747,0-4.773.648-6.023,1.925a4.646,4.646,0,0,0-1.322,2.992,1.2,1.2,0,0,1-1.174,1.226H-2129a1.2,1.2,0,0,1-1.2-1.174,7.053,7.053,0,0,1,2.006-4.721c1.718-1.756,4.322-2.647,7.738-2.647s6.028.888,7.776,2.639a7.058,7.058,0,0,1,2.056,4.729,1.114,1.114,0,0,1-1.052,1.174q-.05,0-.1,0C-2112.787,139.3-2112.987,138.1-2112.987,138.1Zm-12.064-14.108a5,5,0,0,1,4.99-4.991,5,5,0,0,1,4.991,4.991,5,5,0,0,1-4.991,4.991A5,5,0,0,1-2125.051,123.988Zm2.4,0a2.6,2.6,0,0,0,2.591,2.591,2.594,2.594,0,0,0,2.591-2.591,2.593,2.593,0,0,0-2.591-2.591A2.594,2.594,0,0,0-2122.652,123.988Z" transform="translate(2130.199 -118.996)" fill="#191b1f"/>
                        </svg>
                        Profile
                    </router-link>
                </li>
                <li @click="handleDropdown('user_acc_dropdown')">
                    <a href="#" @click.prevent="openSettings" class="flex ai-c gap-10">
                        <svg viewBox="0 0 19.4 21">
                            <path d="M-1980.735,21a3,3,0,0,1-2.588-1.481l-.811-1.382a1,1,0,0,0-.855-.493l-1.6-.014a3,3,0,0,1-2.576-1.5l-.439-.76a3,3,0,0,1-.012-2.974l.792-1.4a1,1,0,0,0,0-.985l-.792-1.4a3,3,0,0,1,.012-2.974l.439-.761a3,3,0,0,1,2.576-1.5l1.6-.013a1,1,0,0,0,.855-.493l.811-1.382A3,3,0,0,1-1980.735,0h.87a3,3,0,0,1,2.588,1.481l.811,1.382a1,1,0,0,0,.854.493l1.6.013a3,3,0,0,1,2.576,1.5l.438.761a3,3,0,0,1,.013,2.974l-.792,1.4a1,1,0,0,0,0,.985l.792,1.4a3,3,0,0,1-.013,2.974l-.438.76a3,3,0,0,1-2.576,1.5l-1.6.014a1,1,0,0,0-.854.493l-.811,1.382A3,3,0,0,1-1979.865,21Zm-.862-18.506-.811,1.382a3,3,0,0,1-2.564,1.481l-1.6.013a1,1,0,0,0-.859.5l-.439.761a1,1,0,0,0,0,.992l.792,1.4a3,3,0,0,1,0,2.953l-.792,1.4a1,1,0,0,0,0,.991l.439.761a1,1,0,0,0,.859.5l1.6.014a3,3,0,0,1,2.564,1.481l.811,1.381a1,1,0,0,0,.862.494h.87a1,1,0,0,0,.863-.494l.811-1.381a3,3,0,0,1,2.563-1.481l1.6-.014a1,1,0,0,0,.859-.5l.438-.761a1,1,0,0,0,0-.991l-.792-1.4a3,3,0,0,1,0-2.953l.792-1.4a1,1,0,0,0,0-.992l-.438-.761a1,1,0,0,0-.859-.5l-1.6-.013a3,3,0,0,1-2.563-1.481L-1979,2.494a1,1,0,0,0-.863-.494h-.87A1,1,0,0,0-1981.6,2.494Zm-2.2,8.006a3.5,3.5,0,0,1,3.5-3.5,3.5,3.5,0,0,1,3.5,3.5,3.5,3.5,0,0,1-3.5,3.5A3.5,3.5,0,0,1-1983.8,10.5Zm2,0a1.5,1.5,0,0,0,1.5,1.5,1.5,1.5,0,0,0,1.5-1.5,1.5,1.5,0,0,0-1.5-1.5A1.5,1.5,0,0,0-1981.8,10.5Z" transform="translate(1990)"/>
                        </svg>
                        Settings
                    </a>
                </li>
                <li @click="handleDropdown('user_acc_dropdown')">
                    <a href="#" @click.prevent="logout" class="flex ai-c gap-10">
                        <svg viewBox="0 0 16.291 17.292">
                            <path d="M-3073.919-628.864a2.912,2.912,0,0,1-2.7-3.08v-4.16a1,1,0,0,1,1-1,1,1,0,0,1,1,1v4.16c0,.636.369,1.08.7,1.08h11.894c.331,0,.7-.444.7-1.08v-4.16a1,1,0,0,1,1-1,1,1,0,0,1,1,1v4.16a2.911,2.911,0,0,1-2.7,3.08Zm4.946-5.953v-6.988l-2.352,2.262a1,1,0,0,1-1.415-.027,1,1,0,0,1,.028-1.414l4.045-3.892a1,1,0,0,1,.442-.247l.007,0,.016,0,.011,0,.012,0,.014,0,.01,0,.014,0,.009,0,.015,0h.008l.015,0h.009l.014,0h.193l.018,0h.005l.019,0h0l.021,0h0l.021,0h0l.022,0,.023.005h0l.022.005h0l.021.005.005,0,.017.005.012,0,.01,0a.979.979,0,0,1,.372.226l4.045,3.892a1,1,0,0,1,.028,1.414,1,1,0,0,1-1.414.027l-2.353-2.263v6.989a1,1,0,0,1-1,1A1,1,0,0,1-3068.973-634.818Z" transform="translate(-628.864 3076.619) rotate(90)"/>
                        </svg>
                        Log out
                    </a>
                </li>
            </ul>
        </div>
    </teleport>
</template>
<script>
import Backdrop from './Backdrop.vue';
import dropdownMixin from '@/mixins/dropdownMixin';
import ProfileAvatar from './ProfileAvatar.vue';
export default {
    name: 'TopBar',
    components: { Backdrop, ProfileAvatar },
    mixins: [dropdownMixin],
    props: {
        auth: Boolean,
        user: Object
    },
    data() {
        return {
            dropdownToggle: false,
        }
    },
    methods: {
        signUp() {
            this.$router.push({ query: { m: 'signup' }}) 
        },
        signIn() {
            this.$router.push({ query: { m: 'signin' }}) 
        },
        async logout() {
            this.$store.dispatch('logout')
        },
        openSettings() {
            this.$router.push({ query: { ...this.$route.query, m: 'settings' } });
        }
    }
}
</script>
<style lang="scss" scoped>
nav {
    -webkit-backdrop-filter: saturate(180%) blur(20px);
    backdrop-filter: saturate(180%) blur(20px);
    background-color: rgba(var(--main-background-primary), .8);
}
.top-bar-wrapper {
    max-width: 1080px;
    height: var(--nav-height);
    padding: 0 20px;
}

button.bg-transparent {
    height: 46px;
    width: 46px;
    &:hover {
        background-color: var(--main-background-2);
    }
    &:active {
        background-color: var(--main-background-3);
        outline-color: var(--main-background-3) !important;
    }
}
.user-name {
    color: var(--main-font-color-primary);
}
.dropdown {
    width: 180px;
    z-index: 102;
    background-color: var(--modal-main-background);
}


a:not(#logo) {
    padding: 8px 18px;
    &:hover {
        background-color: var(--modal-close-button-hover);
    }
    svg {
        height: 16px;
        width: 16px;
    }
}
.sticky {
    z-index: 50;
}
// background-color: rgba(var(--main-background-primary), .7);;
// -webkit-backdrop-filter: saturate(180%) blur(20px);
    // backdrop-filter: saturate(180%) blur(20px);


</style>